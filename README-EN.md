<!-- Language Selector -->
<div align="center">
  <a href="README-EN.md">English</a> | <a href="README.md">Français</a>
</div>

# Wheresmycobblemon?!

## Spawn Data & Discord Bot

This project consists of two main scripts:

- **extract.py**  
  This script extracts spawn data from all JSON files located in the *spawn_pool_world* directories (for example, in a global datapacks folder) and exports the data into an .xlsx file (compatible with Excel, LibreOffice Calc, and other spreadsheet programs). It also resolves biome tags by replacing identifiers (e.g., `#minecraft:is_savanna_plateau`) with the corresponding list of biomes using a tag file.

- **wherepokemon.py**  
  This script is a Discord bot that reads the .xlsx file generated by *extract.py* and responds to the slash commands `/where` (English), `/tesou` (French), `/wobistdu` (German), and `/doko` (Japanese romaji) by displaying the spawn conditions for a given Pokémon, highlighting the optimal location for capturing it!

## Features

- **Spawn Extraction**  
  - Recursive traversal of the directory tree to extract JSON data from *spawn_pool* folders.
  - Extraction of basic spawn conditions (e.g., Pokémon, Bucket, Dimensions, Biomes, Structures, etc.).
  - Extraction of additional conditions, including:
    - **Stone Requirements**: Searches for keys ending with `_stone_requirement` to obtain the number and type of evolution stones.
    - **Custom Pokemons In Team**: Extracts specific Pokémon required in the team along with the necessary quantity.
    - Depth conditions (e.g., `Min Y` and `Max Y`).
  - **Resolution of Biome Tags** using a CSV file:
    - The **extract.py** script uses a CSV file (generated with the [TellMe](https://modrinth.com/mod/tellme) mod using the command `/tellme dump to-file csv biomes-with-tags`) which contains:
      - An *ID* column (ignored)
      - A *Registry name* column (the biome identifier)
      - A *Tags* column (the list of tags associated with the biome)
    - The script reads this file and builds a mapping to replace the tags (e.g., `#minecraft:is_savanna_plateau`) with the corresponding list of biomes.

- **Discord Bot**  
  - Reads the generated .xlsx file.
  - Provides slash commands `/where` (English), `/tesou` (French), `/wobistdu` (German), and `/doko` (Japanese romaji) to display the spawn conditions for a given Pokémon privately (ephemeral).
  - Implements autocomplete for easier Pokémon name entry.

- **Biomes Resolution via Tags**  
  The **extract.py** script uses the CSV file (generated via the [TellMe](https://modrinth.com/mod/tellme) mod) to map biome tags to their corresponding biomes.

- **Translation of Pokémon Names via PokeAPI**
  - Retrieves Pokémon names in English, French, German, and Japanese romaji via PokeAPI.
  - The bot is usable with the names from the .xlsx file during translation!
  - There are two translation categories: `translations` and `undefined_translations`. The bot will use names from "undefined_translations" if a translation isn't found, but you can also manually add translations in the "translations" section.
  - The translations are cached in a file named `pokemon_translations.json` so that you don't have to run translations every time the bot restarts.

## Prerequisites

- Python 3.9 or higher
- Required Python modules (see `requirements.txt`):
  - `pandas`
  - `discord.py`
  - `openpyxl`
  - `requests`
- A ZIP file containing the Cobblemon Pokémon spawn configuration files (for version 1.5.2: [Cobblemon 1.5.2 spawn data](https://gitlab.com/cable-mc/cobblemon/-/archive/1.5.2/cobblemon-1.5.2.zip?path=common/src/main/resources/data/cobblemon/spawn_pool_world))
- Your datapacks folder (e.g., *global_packs*, which contains AllTheMons or other datapacks that add Pokémon)
- Place your datapacks folder and the content of the ZIP file in the same directory.
- The CSV file containing biome tags, generated with the [TellMe](https://modrinth.com/mod/tellme) mod using the command: `/tellme dump to-file csv biomes-with-tags`
  - Rename the generated file to `biomes_tags.csv`
  - Place it in the same directory as `extract.py`.

## Installation

1. Clone this project from GitHub.
2. Install the dependencies with:
 ```
 pip install -r requirements.txt
 ```

## Creating the Discord Bot

Before using the `wherepokemon.py` script, you must create a Discord bot:

1. Visit the [Discord Developer Portal](https://discord.com/developers/applications)
2. Click on "New Application" and give your application a name.
3. In the left menu, click on "Bot".
4. Click on "Add Bot" and confirm.
5. Under the "TOKEN" section, click on "Reset Token" then "Copy" to save your token (keep it secure as you will need it).
6. Enable the following option:
- "MESSAGE CONTENT INTENT" under the "Privileged Gateway Intents" section.
7. Save your changes.
8. Go to "OAuth2" > "URL Generator" in the left menu.
9. Select the scopes "bot" and "applications.commands".
10. Under "Bot Permissions", select at least:
 - "Read Messages/View Channels"
 - "Send Messages"
 - "Use Slash Commands"
11. Copy the generated URL and paste it into your browser to invite the bot to your server.
12. Note your Discord server ID (right-click on the server and select "Copy ID" if Developer Mode is enabled).

## Usage

**Data Extraction**

To extract data from the JSON files and generate an .xlsx file, use the `extract.py` script (or `extract_and_merge.py` if you have merged with an additional spreadsheet).

Example:
 ```
python extract.py /path/to/globaldatapack_folder --biome-tags ./biomes_tags.csv --output my_data.xlsx
 ```
- `/path/to/globaldatapack_folder`: Path to the root folder containing the datapacks and Cobblemon JSON files.
- `--biome-tags`: Path to your `biomes_tags.csv` file.
- `--output my_data.xlsx`: Name of the output .xlsx file.

**Discord Bot**

The `wherepokemon.py` script reads the generated .xlsx file and responds to the `/where` command.

### Using Docker

Configure the following environment variables (via environment variables or directly in the script):

- `DISCORD_BOT_TOKEN`: Your Discord bot token.
- `DISCORD_GUILD_ID`: Your Discord server ID (to quickly synchronize the command).
- `EXCEL_FILE`: Path to the .xlsx file (default is `/documents/my_data.xlsx`).

Example docker-compose.yml:
```
version: '3.8'

services:
  wheresmypokemon:
    container_name: wheresmypokemon
    image: python:3.9
    environment:
      - DISCORD_BOT_TOKEN=
      - DISCORD_GUILD_ID=
    working_dir: /app
    volumes:
      - /your/host/folder/with/my_data.xlsx:/documents
      - /your/host/folder:/app
    command: ["/bin/sh", "-c", "pip install -r /app/requirements.txt && python /app/wherepokemon.py"]
    restart: always
```
To launch the bot via Docker:
 ```
docker-compose up -d
 ```

# Usage Without Docker

If you are not using Docker, install the required dependencies and modify the wherepokemon.py file to include your credentials:

1. Install the dependencies:
   ```
   pip install -r requirements.txt
   ```

2. Open the wherepokemon.py file in a text editor.
3. Locate the lines where the TOKEN and GUILD_ID variables are defined.
4. Replace them with your credentials:
   ```python
   # Replace these lines
   TOKEN = os.getenv("DISCORD_BOT_TOKEN")
   GUILD_ID = int(os.getenv("DISCORD_GUILD_ID", "0"))
   
   # With these lines
   TOKEN = "your_discord_token_here"  # Insert your token between the quotes
   GUILD_ID = int("012345678901234567")  # Replace with your server ID
   ```
5. You can also specify the path to your Excel file and translation file:
   ```python
   EXCEL_FILE = "/path/to/your/my_data.xlsx"
   TRANSLATIONS_CACHE_FILE = "/path/to/your/pokemon_translations.json"
   ```
6. Save the file and run the script:
   ```
   python wherepokemon.py
   ```

Important Note:
Never share or publish your file containing the Discord token, as this could compromise your bot's security.

The `/where` command will then be available on your server, allowing you to display the spawn conditions for a given Pokémon.
